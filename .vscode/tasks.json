{
    "version": "2.0.0",
    "tasks": [
        {
            "type": "npm",
            "script": "build",
            "label": "Backend:rebuild",
            "group": "build",
            "detail": "Build JS backend",
            "options": {
                "cwd": "${workspaceFolder}/js"
            },
            "problemMatcher": []
        },
        {
            "type": "npm",
            "script": "emu:reset",
            "label": "Backend:reset-emulator",
            "group": "build",
            "detail": "Reset emulators for backend",
            "options": {
                "cwd": "${workspaceFolder}/js"
            },
            "problemMatcher": []
        },
        {
            "type": "npm",
            "script": "build:watch",
            "label": "Backend:build:watch",
            "group": "build",
            "detail": "Watch and build JS backend",
            "options": {
                "cwd": "${workspaceFolder}/js"
            },
            "isBackground": true,
            "problemMatcher": [
                "$tsc-watch"
            ]
        },
        {
            "type": "npm",
            "script": "emu:debug",
            "label": "Backend:start-emulator-debug",
            "group": "none",
            "detail": "Start backend emulator (debug)",
            "options": {
                "cwd": "${workspaceFolder}/js"
            },
            "isBackground": true,
            "dependsOn": [
                "Backend:build:watch"
            ],
            "problemMatcher": [
                {
                    "base": "$tsc",
                    "background": {
                        "beginsPattern": "Debugger listening",
                        "endsPattern": "Debugger listening"
                    }
                }
            ]
        },
        {
            "type": "npm",
            "script": "dev",
            "label": "Frontend:start:dev",
            "group": "build",
            "detail": "Start frontend dev server",
            "options": {
                "cwd": "${workspaceFolder}/webapp"
            },
            "isBackground": true,
            "problemMatcher": {
                "base": "$vite",
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "vite",
                    "endsPattern": "OK"
                }
            }
        },
        {
            "type": "npm",
            "script": "dev",
            "label": "Frontend:start:emu",
            "group": "build",
            "detail": "Start frontend dev server (with emulator env)",
            "options": {
                "cwd": "${workspaceFolder}/webapp",
                "env": {
                    "FIREBASE_EMULATE": "true"
                }
            },
            "isBackground": true,
            "problemMatcher": {
                "base": "$vite",
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "vite",
                    "endsPattern": "OK"
                }
            }
        },
        {
            "type": "npm",
            "script": "emu:debug2",
            "label": "Backend:start-emulator-debug:with-proxy",
            "group": "none",
            "detail": "Start backend emulator (debug) with proxy env",
            "options": {
                "cwd": "${workspaceFolder}/js",
                "env": {
                    "https_proxy": "http://127.0.0.1:7890",
                    "http_proxy": "http://127.0.0.1:7890",
                    "all_proxy": "socks5://127.0.0.1:7890"
                }
            },
            "isBackground": true,
            "dependsOn": [
                "Backend:build:watch"
            ],
            "problemMatcher": [
                {
                    "base": "$tsc",
                    "background": {
                        "activeOnStart": false,
                        "beginsPattern": "shutdown requested|Starting emulators",
                        "endsPattern": "Debugger listening"
                    }
                }
            ]
        },
        {
            "label": "Fullstack:prepare",
            "dependsOn": [
                "Frontend:start:emu",
                "Backend:build:watch"
            ]
        },
        {
            "label": "Fullstack:debug",
            "dependsOn": [
                "Backend:start-emulator-debug"
            ]
        },
        {
            "label": "Fullstack:debug:with-proxy",
            "dependsOn": [
                "Frontend:start:emu",
                "Backend:start-emulator-debug:with-proxy"
            ]
        }
    ]
}